<?php

// This is the global social_mediator module. Information that's specific to a individual social network should not be inside this file. 
// This module is shared amongst all the subthemes. 

// need an admin page so that the sub modules have a place to live. 

function social_mediator_menu() {
  $items = array();

  $items['admin/social'] = array (
    'title' => 'Social Mediator',
    'description' => 'Provide API keys to authenticate with Twitter and Instagram',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('_social_mediator_admin_page'),
    'access callback' => TRUE,
    'type' => MENU_NORMAL_ITEM,
  );

  $items['admin/social/importall'] = array (
    'title' => 'Social Mediator',
    'page callback' => '_social_mediator_import',
    'access callback' => TRUE,
  );
  return $items;
}

// set up global social_mediator permissions.


function _social_mediator_admin_page($form, &$form_state) {
  $content = array('Here is the admin landing page for the global social mediator.');

  $form = array();

  $form['sm_twitter_consumer_key'] = array(
    '#type' => 'textfield',
    '#title' => 'Consumer Key',
    '#description' => t('Enter your Consumer Key'),
    '#default_value' => variable_get("sm_twitter_consumer_key", "")
  );

  $form['sm_twitter_consumer_secret'] = array(
    '#type' => 'textfield',
    '#title' => t('Secret Key'),
    '#description' => t('Enter your Secret Key'),
    '#default_value' => variable_get("sm_twitter_consumer_secret", "")
 );

 $form['sm_oauth_access_token'] = array(
    '#type' => 'textfield',
    '#title' => t('OAuth Access Token'),
    '#description' => t('Enter your OAuth Access Token'),
    '#default_value' => variable_get("sm_oauth_access_token", "")
  );

  $form['sm_oauth_access_token_secret'] = array(
    '#type' => 'textfield',
    '#title' => t('OAuth Access Token'),
    '#description' => t('Enter your OAuth Access Secret Token'),
    '#default_value' => variable_get("sm_oauth_access_token_secret", "")
  );

  return system_settings_form($form);
}

// need _function to handle import. This will happen on any imports.

function _social_mediator_import()
{
  $content = array();

  if (sizeof(module_implements('social_mediator_import')) > 0) {
  	$content = module_invoke_all('social_mediator_import', $content);
  } else {
  	$content = array("There are no submodules installed.");
  }

  dsm($content);

  $output = '';
  foreach($content as $c)
  {
    $output .= '<p>' . $c . '</p>';
  }
  return $output;
}

// need hook_cron so that imports happen on cron.